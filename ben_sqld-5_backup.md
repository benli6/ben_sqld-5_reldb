# Домашнее задание к занятию 12.8. «Резервное копирование баз данных»

### Задание 1. Резервное копирование

### Кейс
Финансовая компания решила увеличить надёжность работы баз данных и их резервного копирования. 

Необходимо описать, какие варианты резервного копирования подходят в случаях: 

1.1. Необходимо восстанавливать данные в полном объёме за предыдущий день.

`В данном случае можно использовать дифференциальный бэкап (differential backup), поскольку нас интересуют не все исходные данные, а только новые. Такой бэкап является чем-то средним между полным резервным копированием и инкрементальным, он имеет меньший объем по сравнению с полным бэкапом и создается значительно быстрее.`

1.2. Необходимо восстанавливать данные за час до предполагаемой поломки.

`Можно создавать инкрементный бэкап (Incremental backup) каждый час, поскольку он имеет высокую скорость резервного копирования (копируются только блоки измененных данных), что позволяет сделать большое количество точек восстановления.`

1.3.* Возможен ли кейс, когда при поломке базы происходило моментальное переключение на работающую или починенную базу данных.

`Да, при реализации репликации master-slave, когда вспомогательный сервер slave копирует все данные с мастера. Тогда в случае отказа мастер-сервера можно переключить все операции на слейв, что обеспечит отказоустойчивость приложения.`

---

### Задание 2. PostgreSQL

2.1. С помощью официальной документации приведите пример команды резервирования данных и восстановления БД (pgdump/pgrestore).

`pg_dump — это программа для создания резервных копий базы данных Postgres.` 

`Пример выгрузки базы данных mydb в файл SQL-скрипта:`

```sql 
pg_dump mydb > db.sql
```
`При резервировании можно использовать разные параметры. Например, F указывает формат вывода копии. Наиболее гибкие форматы выходных файлов это «custom» (-Fc) и «directory» (-Fd). Они позволяют выбрать и изменить порядок объектов, поддерживают восстановление в несколько потоков, а также сжимаются по умолчанию. `

`Выгрузка базы данных в специальном формате:`
```sql 
pg_dump -Fc mydb > db.dump
```

`Для восстановления из архивных форматов файлов используется утилита pg_restore. `

`Пример восстановления из архива в чистую новую базу данных newdb:`

```sql 
pg_restore -d newdb db.dump
```

2.1.* Возможно ли автоматизировать этот процесс? Если да, то как?


`Да, например, через планировщик заданий запускать скрипт создания резервных копий в определенное время.`

---

### Задание 3. MySQL

3.1. С помощью официальной документации приведите пример команды инкрементного резервного копирования базы данных MySQL. 

`Для простых, быстрых и удобных инкрементных бэкапах mysql можно использовать утилиту XtraBackup. Для создания инкрементного копирования необходимо иметь полный бэкап базы данных, поскольку икрементный хранит только изменения со времени полного бэкапа. Поэтому сначала создается полный бэкап, на основе которого можно сделать инкрементный.`

```
xtrabackup --backup --target-dir=/root/backupdb/inc1 --incremental-basedir=/root/backupdb/full
```

`Для восстановления данных сначала надо подготовить полную копию для накатывания на нее инкрементого бэкапа.`

```
xtrabackup --prepare --apply-log-only --target-dir=/root/backupdb/full
```
`И потом добавить туда данные из инкрементного бэкапа.`

```
xtrabackup --prepare --apply-log-only --target-dir=/root/backupdb/full --incremental-dir=/root/backupdb/inc1
```

3.1.* В каких случаях использование реплики будет давать преимущество по сравнению с обычным резервным копированием?

`В случае необходимости срочно восстановить работоспособность приложения лучше использовать реплику, которая станет полноценным мастер-сервером. Либо в свлучае, когда резервное копирование делалась давно, так потеря данных будет меньше.`